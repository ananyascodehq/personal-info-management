{% extends 'base.html' %} {% block content %}

<!-- =========================
     PROFILE HEADER
========================= -->
<div class="panel mb-4">
  <div class="d-flex justify-content-between align-items-start">
    <div>
      <h1 class="page-title">{{ person.name }}</h1>
      <p class="page-subtitle">{{ person.email }} · {{ person.phone }}</p>

      {% if person.dob %}
      <p class="text-muted mb-0">DOB: {{ person.dob }}</p>
      {% endif %}
      <p class="text-muted mb-0">Gender: {{ person.gender }}</p>

      {% if person.address %}
      <p class="text-muted mt-2">
        <strong>Address:</strong> {{ person.address }}
      </p>
      {% endif %}
    </div>

    <a
      href="{{ url_for('update_person', id=person.person_id) }}"
      class="btn btn-outline-primary"
    >
      Edit Profile
    </a>
  </div>
</div>

<!-- =========================
     TABS
========================= -->
<ul class="nav nav-tabs mb-3">
  <li class="nav-item">
    <button
      class="nav-link active"
      data-bs-toggle="tab"
      data-bs-target="#career"
      type="button"
    >
      Career
    </button>
  </li>
  <li class="nav-item">
    <button
      class="nav-link"
      data-bs-toggle="tab"
      data-bs-target="#education"
      type="button"
    >
      Education
    </button>
  </li>
</ul>

<div class="tab-content">
  <!-- =========================
       CAREER TAB
  ========================= -->
  <div class="tab-pane fade show active" id="career">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Career Records</h5>
      <a
        href="{{ url_for('add_career', person_id=person.person_id) }}"
        class="btn btn-primary"
      >
        + Add Career
      </a>
    </div>

    {% if careers|length == 0 %}
    <div class="empty-state">
      <p>No career records yet.</p>
    </div>
    {% else %}
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Job Title</th>
            <th>Company</th>
            <th>Experience</th>
            <th>Skills</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for c in careers %}
          <tr>
            <td>{{ c.job_title }}</td>
            <td>{{ c.company }}</td>
            <td>{{ c.years_experience }}</td>
            <td>{{ c.skills }}</td>
            <td>
              <div class="dropdown">
                <button
                  class="btn btn-sm btn-light"
                  data-bs-toggle="dropdown"
                  onclick="event.stopPropagation()"
                >
                  ⋮
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a
                      class="dropdown-item"
                      href="{{ url_for('edit_career', id=c.career_id) }}"
                    >
                      Edit
                    </a>
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <form
                      action="{{ url_for('delete_career', id=c.career_id) }}"
                      method="POST"
                      onsubmit="return showSpinnerOnDelete(this, 'Delete this career record?');"
                    >
                      <button type="submit" class="dropdown-item text-danger">
                        Delete
                      </button>
                    </form>
                  </li>
                </ul>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>

  <!-- =========================
       EDUCATION TAB
  ========================= -->
  <div class="tab-pane fade" id="education">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Education Records</h5>
      <a
        href="{{ url_for('add_education', person_id=person.person_id) }}"
        class="btn btn-primary"
      >
        + Add Education
      </a>
    </div>

    {% if education|length == 0 %}
    <div class="empty-state">
      <p>No education records yet.</p>
    </div>
    {% else %}
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Degree</th>
            <th>Institution</th>
            <th>Year</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for e in education %}
          <tr>
            <td>{{ e.degree }}</td>
            <td>{{ e.institution }}</td>
            <td>{{ e.year_of_passing }}</td>
            <td>
              <div class="dropdown">
                <button
                  class="btn btn-sm btn-light"
                  data-bs-toggle="dropdown"
                  onclick="event.stopPropagation()"
                >
                  ⋮
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a
                      class="dropdown-item"
                      href="{{ url_for('edit_education', id=e.edu_id) }}"
                    >
                      Edit
                    </a>
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <form
                      action="{{ url_for('delete_education', id=e.edu_id) }}"
                      method="POST"
                      onsubmit="return showSpinnerOnDelete(this, 'Delete this education record?');"
                    >
                      <button type="submit" class="dropdown-item text-danger">
                        Delete
                      </button>
                    </form>
                  </li>
                </ul>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>
</div>

<script>
  function showSpinnerOnDelete(form, message) {
    if (confirm(message)) {
      const button = form.querySelector('button[type="submit"]');
      button.disabled = true;
      button.innerHTML = `
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        Deleting...
      `;
      return true; // submit the form
    }
    return false; // do not submit
  }
</script>

{% endblock %}

